## 3.5.7 数据包传输模式概述

### 3.5.7.1 可靠无序传输（RUD）

RUD 模式必须**确保每个数据包仅被交付到目标 SES 一次且仅一次**。
数据包按照它们从网络到达的顺序交付给语义子层。  
该模式使用**选择重传**能力，并允许**语义处理**与**乱序的直接数据投递（Direct Data Placement）**。
直接数据投递指的是：数据从以太网端口直接写入系统内存，无需 CPU 干预。  
RUD 依赖于**序列号机制**来识别丢失和重复的数据包。

---

### 3.5.7.2 可靠有序传输（ROD）

ROD 模式必须**确保每个数据包仅被交付到目标 SES 一次且仅一次，且按 SES 在发起端将数据包传给 PDS 的顺序传送至目标 SES**。
ROD PDC 要求数据包**按照 SES 发送给 PDS 的顺序**进行传输，
这些数据包必须通过同一网络路径（即相同的 entropy 值）有序发送，
并在目标网络端口按相同顺序到达（不考虑异常情况）。

**ROD 使用 GoBackN 重传机制**。
该机制丢弃所有乱序到达的数据包，并要求发送方从第一个丢失的 PSN（记为 N）重新开始重传。  
即：从 PSN N 开始，所有数据包都需重新发送。

- ROD 的确认（ACK）必须按照其确认的数据包的顺序发送。
- 读请求的响应也必须按照数据包顺序传输。
- **前向方向的 PDS ACK 与返回方向的读响应之间没有顺序要求**。
- 当请求ACK时，ACK可以被发送并且到达时是无序的，例如基于接收重复的数据包或ACK请求CP，详见第 **3.5.21.1 节**。

---

### 3.5.7.3 用于幂等操作的可靠无序传输（RUDI）

**幂等（idempotent）** 指的是：即使同一个数据包被目标 SES 多次处理，结果仍保持一致。
例如，多次向相同地址执行 RMA Write 或 RMA Read。

RUDI 模式必须**确保每个数据包至少被传送一次至 SES**。
数据包按照其从网络到达的顺序交付，每一个 RUDI 数据包都不去重，直接传递给 SES。

**PDS 为每个数据包分配唯一标识符（RUDI packet ID）**。这些 ID 不需要彼此有关联，也不需递增。

相较于 RUD，RUDI 利用“允许多次投递”的放松条件，在可扩展性与 endpoint 状态开销方面更高效。
RUDI **无需在目标维护任何 PDS 或 SES 状态**，每个请求都有一个响应，支持乱序 DDP，在 PDS/SES 层非常高效。

RUDI **不使用 ACK**。每个请求的响应即为其确认。使用 **NACK** 进行丢包的早期检测。

典型应用场景为：
执行大量跨多个目的地的 RMA Write / RMA Read 操作后执行 barrier。
例如：应用程序可以使用 RUDI 在多个参与进程之间交换数据，
当所有传输完成后，发送一个带有 completion 的特殊包，通知目标“所有数据传输已完成”。

PDS 不识别幂等性，**由 SES 决定是否可以使用 RUDI**。非幂等操作不得使用 RUDI。

当在某 FEP 上使用 **UET 拥塞控制（UET-CC）** 且将 RUDI 放入与 RUD/ROD 相同的流类别中时，  
**应用必须自行避免造成网络拥塞。RUDI 不受 UET-CC 控制。**
当 RUDI 用于大规模数据传输时，**不应与使用 UET-CC 的 RUD/ROD 使用相同的 traffic class**，否则可能影响后者性能。

---

### 3.5.7.4 不可靠无序传输（UUD）

UUD 是一种基础的数据报服务（datagram service），提供**尽力而为（best-effort）传输**。

UUD 的目标是避免应用使用不同的语义子层或网络 API（如 UDP）来访问不可靠数据报服务。

当在某 FEP 上使用 **UET-CC** 并将 UUD 与 RUD/ROD 分配在同一个 traffic class 中时，  
**应用必须自行避免造成网络拥塞**，因为 **UUD 不受 UET-CC 控制**。
若 UUD 用于大规模数据传输，**不应与使用 UET-CC 的 RUD/ROD 使用相同的流类别**，否则可能影响其性能。

> 💡 信息提示：**标准没有定义 “无可靠保证的有序传输” 模式**。提供的这四种模式已覆盖常见的使用场景。

---

### 3.5.7.5 有序数据包 vs. 有序消息

PDS 支持**有序**与**无序**的数据包传输模式。PDS 通过为每个 PDC 管理 **包序号（PSN）空间**来实现有序传输。

然而，**PDS 不知晓消息层级的顺序**，**消息顺序由 SES 负责维护**。
